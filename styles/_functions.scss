@use "sass:list";
@use "variables" as v;

/*
pré-requis : les breakpoints doivent être créés en dernier
1. on ne tient pas compte des positions ni des breakpoints et on loop sur les values pour créer le plus petit niveau m-1
2. on tient compte des positions pour créer les positions sans breakpoints ml-1
3. on tient compte des breakpoints s'ils sont demandés avec $with-breakpoints et on loop sur les breakpoints et dans chaque breakpoint :
  a) on ne tient pas compte des positions m-sm-2
  b) on tient compte des positions ml-sm-2

see https://stackoverflow.com/questions/10262082/css-media-queries-and-important
someone wrote :  I realized that media queries have to be at the end of style sheets (even if you're using/importing multiple files on your workflow).
pour toutes les classes qui se passent les unes par-dessus les autres (d-flex d-md-none d-lg-flex, par exemple), il faut créer une seule media-query et mettre toutes les classes concernées dedans
l'erreur serait de créer une classe et de lui donner sa propre media-query car des media-queries se retrouveraient avant d'autres alors qu'elles devraient être après
*/

@mixin set-classes($prefix, $property, $values, $positions, $with-breakpoints) {
  // 1. creates the classes without the positions nor the breakpoints
  @include loop-on-values($prefix, $property, $values, false);

  // 2. creates the classes for the positions but not for the breakpoints
  @if $positions {
    @include loop-on-positions($prefix, $property, $values, $positions, false);
  }

  // 3. creates the breakpoints
  @if $with-breakpoints {
    @include loop-on-breakpoints($prefix, $property, $values, $positions);
  }
}

@mixin loop-on-positions(
  $prefix,
  $property,
  $values,
  $positions,
  $breakpoint-short
) {
  @each $position-short, $position-long in $positions {
    $new-prefix: $prefix + $position-short; // ml
    $properties: set-properties-list(
      $property,
      $position-long
    ); // could be only one, like "right" for "r", could be "right" & "left" for "x", return (margin-right, margin-left)

    @include loop-on-values(
      $new-prefix,
      $properties,
      $values,
      $breakpoint-short
    );
  }
}

@function set-properties-list($property, $position-long) {
  $properties: ();
  @each $position-long-el in $position-long {
    $properties: list.append($properties, $property + "-" + $position-long-el);
  }
  @return $properties;
}

@mixin loop-on-breakpoints($prefix, $property, $values, $positions) {
  @each $breakpoint-short, $breakpoint-value in v.$breakpoints {
    @media (min-width: $breakpoint-value) {
      // 3.a) creates the classes without the positions
      @include loop-on-values($prefix, $property, $values, $breakpoint-short);

      // 3.b) creates the classes for the positions
      @if $positions {
        @include loop-on-positions(
          $prefix,
          $property,
          $values,
          $positions,
          $breakpoint-short
        );
      }
    }
  }
}

@mixin loop-on-values($prefix, $properties, $values, $breakpoint-short) {
  @each $value-short, $value-long in $values {
    @if $breakpoint-short {
      .#{$prefix}-#{$breakpoint-short}-#{$value-short} {
        @include write-properties($properties, $value-long);
      }
    } @else {
      .#{$prefix}-#{$value-short} {
        @include write-properties($properties, $value-long);
      }
    }
  }
}

@mixin write-properties($properties, $value-long) {
  @each $property in $properties {
    #{$property}: $value-long;
  }
}
